{% extends 'base.html' %}
{% load permissions %}

{% block title %}Transactions - {{ wakala.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center flex-wrap mb-4">
    <div>
        <h4 class="mb-1">
            <i class="bi bi-receipt text-primary"></i> {{ wakala.name }} - Transactions
        </h4>
        <p class="text-muted mb-0">All financial transactions</p>
    </div>
    <div class="d-flex gap-2 mt-3 mt-md-0">
        <a href="{% url 'dashboard:wakala' wakala_id=wakala.id %}" class="anna-btn anna-btn-secondary">
            <i class="bi bi-arrow-left"></i> Back
        </a>
        {% can_record_transaction user wakala as can_record %}
        {% if can_record %}
        <a href="{% url 'wakala:transaction_create' wakala_id=wakala.id %}" class="anna-btn anna-btn-primary">
            <i class="bi bi-plus-circle"></i> New Transaction
        </a>
        {% endif %}
    </div>
</div>

<div class="anna-card">
    <div class="anna-card-body p-0">
        {% if transactions %}
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead>
                    <tr>
                        <th>Code</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Customer</th>
                        <th>Method</th>
                        <th>Date</th>
                        <th>Status</th>
                        {% can_edit_transaction user transaction as can_edit %}{% if can_edit %}<th>Actions</th>{% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td>
                            <a href="{% url 'wakala:transaction_detail' wakala_id=wakala.id transaction_id=transaction.id %}" class="fw-medium">
                                {{ transaction.transaction_code }}
                            </a>
                        </td>
                        <td>
                            <span class="badge {% if transaction.transaction_type == 'deposit' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ transaction.get_transaction_type_display }}
                            </span>
                        </td>
                        <td>{% format_tzs transaction.amount %}</td>
                        <td>{{ transaction.customer_name|default:"-" }}</td>
                        <td>{{ transaction.payment_method }}</td>
                        <td>{{ transaction.created_at|date:"M d, Y H:i" }}</td>
                        <td>
                            <span class="badge {% if transaction.status == 'completed' %}bg-success{% elif transaction.status == 'pending' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ transaction.status|title }}
                            </span>
                        </td>
                        {% can_edit_transaction user transaction as can_edit %}
                        {% if can_edit %}
                        <td>
                            <a href="{% url 'wakala:edit_transaction' wakala_id=wakala.id transaction_id=transaction.id %}" class="anna-btn anna-btn-sm anna-btn-icon" title="Edit">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                        {% endif %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if is_paginated %}
        <div class="px-4 py-3 border-top">
            {% include 'components/pagination.html' %}
        </div>
        {% endif %}
        {% else %}
        <div class="anna-empty-state py-8">
            <i class="bi bi-receipt anna-empty-state-icon"></i>
            <h6 class="anna-empty-state-title">No Transactions</h6>
            <p class="anna-empty-state-message">No transactions have been recorded yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
