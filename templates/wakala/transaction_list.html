{% extends 'base.html' %}
{% load permissions %}

{% block title %}Transactions - {{ wakala.name }}{% endblock %}

{% block content %}
{# Page Header #}
<div class="anna-page-header">
    <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div class="me-3">
            <h4 class="anna-page-title">
                <i class="bi bi-receipt text-primary"></i> {{ wakala.name }} - Transactions
            </h4>
            <p class="anna-page-subtitle">All financial transactions</p>
        </div>
        <div class="anna-page-actions">
            <a href="{% url 'dashboard:wakala' wakala_id=wakala.id %}" class="anna-btn anna-btn-secondary">
                <i class="bi bi-arrow-left"></i> <span class="d-none d-sm-inline">Back</span>
            </a>
            {% can_record_transaction user wakala as can_record %}
            {% if can_record %}
            <a href="{% url 'wakala:transaction_create' wakala_id=wakala.id %}" class="anna-btn anna-btn-primary">
                <i class="bi bi-plus-circle"></i> <span class="d-none d-sm-inline">New Transaction</span>
            </a>
            {% endif %}
        </div>
    </div>
</div>

<div class="anna-card">
    <div class="anna-card-body p-0">
        {% if transactions %}
        <div class="table-responsive">
            <table class="anna-table mb-0">
                <thead>
                    <tr>
                        <th style="width: 100px;">Code</th>
                        <th style="width: 100px;">Type</th>
                        <th style="width: 120px;">Amount</th>
                        <th>Customer</th>
                        <th class="d-none d-md-table-cell" style="width: 120px;">Method</th>
                        <th style="width: 140px;">Date</th>
                        <th style="width: 90px;">Status</th>
                        <th style="width: 60px;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transaction in transactions %}
                    <tr>
                        <td>
                            <a href="{% url 'wakala:transaction_detail' wakala_id=wakala.id transaction_id=transaction.id %}" class="fw-medium">
                                {{ transaction.transaction_code }}
                            </a>
                        </td>
                        <td>
                            <span class="badge {% if transaction.transaction_type == 'deposit' %}bg-success{% else %}bg-danger{% endif %}">
                                {{ transaction.get_transaction_type_display }}
                            </span>
                        </td>
                        <td class="anna-amount">{% format_tzs transaction.amount %}</td>
                        <td>{{ transaction.customer_name|default:"-" }}</td>
                        <td class="d-none d-md-table-cell">{{ transaction.payment_method }}</td>
                        <td>{{ transaction.created_at|date:"M d, H:i" }}</td>
                        <td>
                            <span class="badge {% if transaction.status == 'completed' %}bg-success{% elif transaction.status == 'pending' %}bg-warning{% else %}bg-secondary{% endif %}">
                                {{ transaction.status|title }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'wakala:transaction_detail' wakala_id=wakala.id transaction_id=transaction.id %}" class="anna-btn anna-btn-sm anna-btn-icon" title="View">
                                <i class="bi bi-eye"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        {% if is_paginated %}
        <div class="px-4 py-3 border-top">
            {% include 'components/pagination.html' %}
        </div>
        {% endif %}
        {% else %}
        <div class="anna-empty-state">
            <i class="bi bi-receipt anna-empty-state-icon"></i>
            <h6 class="anna-empty-state-title">No Transactions</h6>
            <p class="anna-empty-state-message">No transactions have been recorded yet.</p>
            {% if can_record %}
            <a href="{% url 'wakala:transaction_create' wakala_id=wakala.id %}" class="anna-btn anna-btn-primary">
                <i class="bi bi-plus-circle"></i> First Transaction
            </a>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
