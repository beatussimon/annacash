{% extends 'base.html' %}

{% block title %}Settings - ANNA{% endblock %}

{% block content %}
{# Page Header #}
<div class="anna-page-header">
    <div class="d-flex justify-content-between align-items-start flex-wrap">
        <div class="me-3">
            <h4 class="anna-page-title">
                <i class="bi bi-gear text-primary"></i> Settings
            </h4>
            <p class="anna-page-subtitle">Manage your ANNA account preferences.</p>
        </div>
        <div class="anna-page-actions">
            <a href="/" class="anna-btn anna-btn-secondary">
                <i class="bi bi-arrow-left"></i> Back Home
            </a>
        </div>
    </div>
</div>

<div class="row g-4">
    {# Appearance Settings #}
    <div class="col-md-6">
        <div class="anna-card h-100">
            <div class="anna-card-header">
                <h5 class="anna-card-title">
                    <i class="bi bi-palette me-2"></i> Appearance
                </h5>
            </div>
            <div class="anna-card-body">
                <div class="mb-4">
                    <label class="anna-form-label fw-bold">Theme</label>
                    <p class="text-muted small mb-3">Choose your preferred color scheme.</p>
                    
                    <div class="d-flex gap-3 flex-wrap">
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="theme" id="themeLight" value="light">
                            <label class="form-check-label" for="themeLight">
                                <i class="bi bi-sun-fill text-warning me-1"></i> Light
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="theme" id="themeDark" value="dark">
                            <label class="form-check-label" for="themeDark">
                                <i class="bi bi-moon-fill text-primary me-1"></i> Dark
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="theme" id="themeSystem" value="system">
                            <label class="form-check-label" for="themeSystem">
                                <i class="bi bi-gear-fill text-secondary me-1"></i> System
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="anna-card-footer">
                <button class="anna-btn anna-btn-primary" id="saveThemeBtn">
                    <i class="bi bi-check-circle"></i> Save Theme
                </button>
            </div>
        </div>
    </div>
    
    {# Language Settings #}
    <div class="col-md-6">
        <div class="anna-card h-100">
            <div class="anna-card-header">
                <h5 class="anna-card-title">
                    <i class="bi bi-globe me-2"></i> Language
                </h5>
            </div>
            <div class="anna-card-body">
                <div class="anna-form-group">
                    <label class="anna-form-label fw-bold">Display Language</label>
                    <p class="text-muted small mb-2">Choose your preferred language.</p>
                    <select class="anna-form-input" id="languageSelect">
                        <option value="sw" selected>Swahili</option>
                        <option value="en">English</option>
                    </select>
                </div>
                
                <div class="anna-form-group">
                    <label class="anna-form-label fw-bold">Number Format</label>
                    <select class="anna-form-input">
                        <option value="tz" selected>Tanzania (1,234,567.89)</option>
                        <option value="us">US (1,234,567.89)</option>
                        <option value="eu">Europe (1.234.567,89)</option>
                    </select>
                </div>
                
                <div class="anna-form-group mb-0">
                    <label class="anna-form-label fw-bold">Currency</label>
                    <select class="anna-form-input">
                        <option value="tzs" selected>TZS (Tanzanian Shilling)</option>
                        <option value="usd">USD (US Dollar)</option>
                    </select>
                </div>
            </div>
            <div class="anna-card-footer">
                <button class="anna-btn anna-btn-primary">
                    <i class="bi bi-check-circle"></i> Save Settings
                </button>
            </div>
        </div>
    </div>
    
    {# Notifications Settings #}
    <div class="col-md-6">
        <div class="anna-card h-100">
            <div class="anna-card-header">
                <h5 class="anna-card-title">
                    <i class="bi bi-bell me-2"></i> Notifications
                </h5>
            </div>
            <div class="anna-card-body">
                <div class="anna-form-group">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                        <label class="form-check-label" for="emailNotifications">Email Notifications</label>
                    </div>
                    <small class="text-muted d-block mt-1">Receive updates via email</small>
                </div>
                
                <div class="anna-form-group">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="smsNotifications" checked>
                        <label class="form-check-label" for="smsNotifications">SMS Notifications</label>
                    </div>
                    <small class="text-muted d-block mt-1">Receive updates via SMS</small>
                </div>
                
                <div class="anna-form-group">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="pushNotifications">
                        <label class="form-check-label" for="pushNotifications">Push Notifications</label>
                    </div>
                    <small class="text-muted d-block mt-1">Receive browser notifications</small>
                </div>
            </div>
            <div class="anna-card-footer">
                <button class="anna-btn anna-btn-primary">
                    <i class="bi bi-check-circle"></i> Save Notifications
                </button>
            </div>
        </div>
    </div>
    
    {# Security Settings #}
    <div class="col-md-6">
        <div class="anna-card h-100">
            <div class="anna-card-header">
                <h5 class="anna-card-title">
                    <i class="bi bi-shield-lock me-2"></i> Security
                </h5>
            </div>
            <div class="anna-card-body">
                <div class="anna-form-group">
                    <label class="anna-form-label fw-bold">Session Timeout</label>
                    <select class="anna-form-input">
                        <option value="30">30 minutes</option>
                        <option value="60" selected>1 hour</option>
                        <option value="120">2 hours</option>
                        <option value="480">8 hours</option>
                    </select>
                    <small class="text-muted d-block mt-1">Auto logout after inactivity</small>
                </div>
                
                <div class="anna-form-group">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="twoFactorAuth">
                        <label class="form-check-label" for="twoFactorAuth">Two-Factor Authentication</label>
                    </div>
                    <small class="text-muted d-block mt-1">Add extra security to your account</small>
                </div>
                
                <div class="anna-form-group mb-0">
                    <a href="{% url 'accounts:password_change' %}" class="anna-btn anna-btn-secondary">
                        <i class="bi bi-key"></i> Change Password
                    </a>
                </div>
            </div>
            <div class="anna-card-footer">
                <button class="anna-btn anna-btn-primary">
                    <i class="bi bi-check-circle"></i> Save Security
                </button>
            </div>
        </div>
    </div>
    
    {# Account Info #}
    <div class="col-12">
        <div class="anna-card">
            <div class="anna-card-header">
                <h5 class="anna-card-title">
                    <i class="bi bi-person me-2"></i> Account Information
                </h5>
            </div>
            <div class="anna-card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="anna-form-group mb-0">
                            <label class="anna-form-label fw-bold">Full Name</label>
                            <input type="text" class="anna-form-input" value="{{ user.get_full_name }}" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="anna-form-group mb-0">
                            <label class="anna-form-label fw-bold">Email</label>
                            <input type="email" class="anna-form-input" value="{{ user.email }}" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="anna-form-group mb-0">
                            <label class="anna-form-label fw-bold">Phone</label>
                            <input type="tel" class="anna-form-input" value="{{ user.phone_number|default:'Not set' }}" readonly>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="anna-form-group mb-0">
                            <label class="anna-form-label fw-bold">Member Since</label>
                            <input type="text" class="anna-form-input" value="{{ user.date_joined|date:'F Y' }}" readonly>
                        </div>
                    </div>
                </div>
            </div>
            <div class="anna-card-footer">
                <a href="{% url 'accounts:profile' %}" class="anna-btn anna-btn-primary">
                    <i class="bi bi-pencil"></i> Edit Profile
                </a>
            </div>
        </div>
    </div>
</div>

{# JavaScript for Theme Settings #}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const themeRadios = document.querySelectorAll('input[name="theme"]');
        const saveThemeBtn = document.getElementById('saveThemeBtn');
        
        // Check current theme and set radio button
        const savedTheme = localStorage.getItem('anna-theme') || 'system';
        document.querySelector('input[name="theme"][value="' + savedTheme + '"]').checked = true;
        
        // Handle system preference
        function getSystemTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }
        
        // Save theme preference
        saveThemeBtn.addEventListener('click', function() {
            const selectedTheme = document.querySelector('input[name="theme"]:checked').value;
            const html = document.documentElement;
            
            if (selectedTheme === 'system') {
                localStorage.removeItem('anna-theme');
                const systemTheme = getSystemTheme();
                html.setAttribute('data-theme', systemTheme);
            } else {
                localStorage.setItem('anna-theme', selectedTheme);
                html.setAttribute('data-theme', selectedTheme);
            }
            
            // Show success message
            const alertDiv = document.createElement('div');
            alertDiv.className = 'anna-alert anna-alert-success fade-in mt-3';
            alertDiv.innerHTML = '<i class="bi bi-check-circle anna-alert-icon"></i><div class="anna-alert-content">Theme saved successfully!</div>';
            saveThemeBtn.closest('.anna-card-footer').prepend(alertDiv);
            
            setTimeout(function() {
                alertDiv.remove();
            }, 3000);
        });
        
        // Preview theme on radio change
        themeRadios.forEach(function(radio) {
            radio.addEventListener('change', function() {
                const html = document.documentElement;
                const theme = this.value === 'system' ? getSystemTheme() : this.value;
                html.setAttribute('data-theme', theme);
            });
        });
    });
</script>
{% endblock %}
